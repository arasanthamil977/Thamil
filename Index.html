<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bird Sort Puzzle</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial;
  background:linear-gradient(#dff3ff,#fff);
  text-align:center
}
header{padding:10px;font-size:18px;font-weight:bold}
button{padding:8px 12px;margin:6px}
input{padding:8px;margin:6px;width:200px}

.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;padding:20px}
.userBtn{padding:20px;border-radius:12px;background:#e0e0e0}

#userSelect,#levelSelect,#game,#nameEntry{display:none}

.branch{
  width:72px;height:230px;
  background:#8b5a2b;
  border-radius:14px;
  display:flex;
  flex-direction:column-reverse;
  align-items:center;
  padding:6px 0;
  cursor:pointer;
  position:relative;
}

.bird{
  font-size:30px;
  transition:transform 0.2s ease;
  position:relative;
}

/* ---------- PER-BIRD GLOW COLORS ---------- */
.glow-ğŸ¦{box-shadow:0 0 14px #ff4fa3}
.glow-ğŸ¦œ{box-shadow:0 0 14px #4caf50}
.glow-ğŸ¤{box-shadow:0 0 14px #ffeb3b}
.glow-ğŸ•Šï¸{box-shadow:0 0 14px #03a9f4}
.glow-ğŸ¦‰{box-shadow:0 0 14px #9c27b0}
.glow-ğŸ§{box-shadow:0 0 14px #2196f3}
.glow-ğŸ¥{box-shadow:0 0 14px #ff9800}
.glow-ğŸ¦†{box-shadow:0 0 14px #009688}
.glow-ğŸ¦¢{box-shadow:0 0 14px #ffffff}
.glow-ğŸ“{box-shadow:0 0 14px #f44336}

/* ---------- FLYING ARC ---------- */
.fly{
  animation:flyArc 0.45s ease-in-out forwards;
}

@keyframes flyArc{
  0%{transform:translate(0,0) scale(1)}
  50%{transform:translate(0,-60px) scale(1.2)}
  100%{transform:translate(0,0) scale(1)}
}
</style>
</head>

<body>

<header>ğŸ¦ Bird Sort Puzzle</header>

<div id="userSelect">
  <h3>Select User</h3>
  <div class="grid">
    <div class="userBtn" onclick="selectUser(1)">User 1<br><span id="u1"></span></div>
    <div class="userBtn" onclick="selectUser(2)">User 2<br><span id="u2"></span></div>
    <div class="userBtn" onclick="selectUser(3)">User 3<br><span id="u3"></span></div>
  </div>
</div>

<div id="nameEntry">
  <h3>Enter Name</h3>
  <input id="username">
  <br>
  <button onclick="saveName()">Continue</button>
</div>

<div id="levelSelect">
  <h3 id="welcome"></h3>
  <div id="grid" style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px;padding:15px"></div>
</div>

<div id="game">
  <div>
    Level <span id="lvl"></span> |
    â± <span id="time">0</span>s |
    Moves <span id="moves">0</span>
  </div>

  <button onclick="resetLevel()">ğŸ”„ Reset</button>
  <button onclick="back()">â¬… Levels</button>
  <button onclick="switchUser()">ğŸ‘¤ Switch User</button>

  <div id="board" style="display:flex;flex-wrap:wrap;gap:14px;justify-content:center;padding:15px"></div>
</div>

<script>
/* ---------- CONFIG ---------- */
const MAX=4, TOTAL_LEVELS=1000;
const ALL_BIRDS=["ğŸ¦","ğŸ¦œ","ğŸ¤","ğŸ•Šï¸","ğŸ¦‰","ğŸ§","ğŸ¥","ğŸ¦†","ğŸ¦¢","ğŸ“"];

/* ---------- AUDIO ---------- */
function playMoveSound(){
  const ctx=new (window.AudioContext||window.webkitAudioContext)();
  const o=ctx.createOscillator(), g=ctx.createGain();
  o.frequency.setValueAtTime(900,ctx.currentTime);
  o.frequency.exponentialRampToValueAtTime(1300,ctx.currentTime+0.15);
  g.gain.setValueAtTime(0.25,ctx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+0.2);
  o.connect(g); g.connect(ctx.destination);
  o.start(); o.stop(ctx.currentTime+0.2);
}

function playWinSound(){
  const ctx=new (window.AudioContext||window.webkitAudioContext)();
  const o=ctx.createOscillator(), g=ctx.createGain();
  o.frequency.setValueAtTime(700,ctx.currentTime);
  o.frequency.exponentialRampToValueAtTime(1200,ctx.currentTime+0.5);
  g.gain.setValueAtTime(0.3,ctx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+0.6);
  o.connect(g); g.connect(ctx.destination);
  o.start(); o.stop(ctx.currentTime+0.6);
}

/* ---------- USER ---------- */
let currentUser=null, userKey="", userData=null;

function loadUsers(){
  for(let i=1;i<=3;i++){
    const u=JSON.parse(localStorage.getItem("birdUser_"+i));
    document.getElementById("u"+i).innerText=u?u.name:"(Empty)";
  }
}

function selectUser(id){
  currentUser=id;
  userKey="birdUser_"+id;
  const data=JSON.parse(localStorage.getItem(userKey));
  if(!data){
    userSelect.style.display="none";
    nameEntry.style.display="block";
  }else{
    userData=data;
    showLevels();
  }
}

function saveName(){
  const name=username.value.trim();
  if(!name)return alert("Enter name");
  userData={name,unlocked:1,stars:{}};
  localStorage.setItem(userKey,JSON.stringify(userData));
  showLevels();
}

function switchUser(){
  game.style.display="none";
  levelSelect.style.display="none";
  userSelect.style.display="block";
  loadUsers();
}

/* ---------- LEVEL SELECT ---------- */
function showLevels(){
  nameEntry.style.display="none";
  userSelect.style.display="none";
  levelSelect.style.display="block";
  welcome.innerText="Welcome, "+userData.name;

  grid.innerHTML="";
  for(let i=1;i<=TOTAL_LEVELS;i++){
    const d=document.createElement("div");
    d.style.padding="12px";
    d.style.background=i>userData.unlocked?"#bbb":"#e0e0e0";
    d.innerHTML=`Lv ${i}<br>${"â­".repeat(userData.stars[i]||0)}`;
    if(i<=userData.unlocked)d.onclick=()=>start(i);
    grid.appendChild(d);
  }
}

/* ---------- GAME ---------- */
let branches=[], selected=null;
let moves=0, time=0, timer, level=1;

function getConfig(l){
  if(l<=10)return{birds:3,empty:2};
  if(l<=20)return{birds:4,empty:2};
  return{birds:10,empty:1};
}

function start(l){
  level=l; moves=0; time=0;
  lvl.innerText=l;
  levelSelect.style.display="none";
  game.style.display="block";
  generate(l);
  startTimer();
  render();
}

function resetLevel(){ start(level); }

function generate(l){
  const c=getConfig(l);
  const birds=ALL_BIRDS.slice(0,c.birds);
  const pool=[];
  birds.forEach(b=>{for(let i=0;i<MAX;i++)pool.push(b)});
  pool.sort(()=>Math.random()-0.5);
  branches=Array.from({length:birds.length+c.empty},()=>[]);
  pool.forEach((b,i)=>branches[i%(branches.length-c.empty)].push(b));
}

function render(){
  board.innerHTML="";
  branches.forEach((br,i)=>{
    const d=document.createElement("div");
    d.className="branch";
    d.onclick=()=>selectBranch(i);

    br.forEach((x,idx)=>{
      const e=document.createElement("div");
      e.className="bird";
      e.innerText=x;
      if(selected===i && idx===br.length-1){
        e.classList.add("glow-"+x);
      }
      d.appendChild(e);
    });
    board.appendChild(d);
  });
  document.getElementById("moves").innerText=moves;
}

function selectBranch(i){
  if(selected===null){
    if(!branches[i].length)return;
    selected=i;
  }else{
    move(selected,i);
    selected=null;
  }
  render();
}

function move(f,t){
  if(f===t)return;
  const a=branches[f], b=branches[t];
  if(!a.length||b.length>=MAX)return;
  const bird=a.at(-1);
  if(b.length&&b.at(-1)!==bird)return;

  playMoveSound();

  let c=0;
  for(let i=a.length-1;i>=0;i--){
    if(a[i]===bird)c++; else break;
  }
  const m=Math.min(c,MAX-b.length);

  for(let i=0;i<m;i++)b.push(a.pop());
  moves++;
  checkWin();
}

function checkWin(){
  if(branches.every(b=>!b.length||(b.length===MAX&&b.every(x=>x===b[0])))){
    clearInterval(timer);
    playWinSound();
    let stars=1;
    if(time<40&&moves<15)stars=3;
    else if(time<70&&moves<30)stars=2;
    userData.stars[level]=Math.max(userData.stars[level]||0,stars);
    if(level===userData.unlocked)userData.unlocked++;
    localStorage.setItem(userKey,JSON.stringify(userData));
    setTimeout(showLevels,1000);
  }
}

function startTimer(){
  clearInterval(timer);
  timer=setInterval(()=>{time++;document.getElementById("time").innerText=time},1000);
}

function back(){
  clearInterval(timer);
  showLevels();
}

/* ---------- START ---------- */
userSelect.style.display="block";
loadUsers();
</script>

</body>
</html>
